---
description: >-
  This API is called by the client to create a credit and a subsequent debit
  transaction entry into the wallet.
---

# Just in Time Account Funding API

This API is called by client during the time of a transaction where in customer's prepaid wallet is 'Just in time' (JIT) loaded with the transaction amount. Prepaid system will subsequently debit the same amount from customer's wallet to process the transaction. This API will always ensure that both the load and unload event are always successful together or unsuccessful together

This API can be called during multiple user scenarios like

1. When the customer makes a payment to Merchant using BNPL Credit limit funded ‘Just-in time’ during the transaction
2. When Merchant refunds the transaction which is credit back to the customer as BNPL Credit limit

Client can raise this LoadUnload request basis Customer’s customer ID or mobile number or URN.

{% swagger method="post" path="" baseUrl="api/v2/customer/loadunloadaccount" summary="" %}
{% swagger-description %}
Request body will contain the encrypted token. Encryption will be done by the client using the client key provided by Wibmo Team. Encryption/ Decryption methodology - AES 192 CBC.

Note - Below are the request parameters in clear text that needs to be encrypted by the client. The below parameters should not be shared in clear text.
{% endswagger-description %}

{% swagger-parameter in="body" name="token" type="String" required="true" %}
Request body will contain the encrypted token. Encryption will be done by the client using the client key provided by Wibmo Team. Encryption/ Decryption methodology - AES-192-CBC

Note - Below are the request parameters in clear text that need to be encrypted by the client. The below parameters should not be shared in clear text.
{% endswagger-parameter %}

{% swagger-parameter in="header" name="x-api-key" required="true" type="String" %}
Special token that the client needs to provide when making API calls. Will be shared along with access to Prepaid Platform Sandbox environment | Ex. -ABCDEF12345
{% endswagger-parameter %}

{% swagger-parameter in="body" name="messageCode" type="Numeric(4)" required="true" %}
Code to identity Load Unload Account request API | Ex.

`1990`
{% endswagger-parameter %}

{% swagger-parameter in="header" name="clientId" type="String(15)" required="true" %}
Uniquely identifies the Client. During program enrollment each Client is provided with a unique client id by Prepaid Aero. | Ex.

`FintechA`
{% endswagger-parameter %}

{% swagger-parameter in="header" name="bankId " type="Numeric(4)" required="true" %}
Uniquely identify the card issuer. Bank Id is provided by Prepaid Platform during program enrollment to uniquely identify the card issuer | Ex.

`1234`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="clientTxnId" type="String (100)" required="true" %}
Unique Id generated by the client for each API request. | Ex.

`20150701235959xhstiesqfds`
{% endswagger-parameter %}

{% swagger-parameter in="header" name="entityId " type="Numeric(4)" required="false" %}
Defaults to parent branch of the client i.e., 100 if not provided. This option is useful if cards need to be created and activated under a specific entity/outlet |

`100`
{% endswagger-parameter %}

{% swagger-parameter in="header" name="secureCode" type="String(25)" required="true" %}
Unique static parameter to uniquely identifies the client on payload level for performing operations. | Ex.

`ABCD12345`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="requestDateTime " type="Numeric(14)" required="true" %}
Local Date and time stamp when the transaction originated from the client in YYYYMMDDHHMMSS with time in 24-hour format | Ex:

`20161031000000`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="customerMobile" type="numeric(20)" required="false" %}
<mark style="background-color:purple;">This is a conditional field.</mark>

Mobile number of the cardholder | Ex:

`9897123456`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="customerId " type="String(20)" required="true" %}
Customer Id, which uniquely identifies the cardholder in the client system | Ex.

`IN0000000001`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="urn" type="numeric(10)" required="false" %}
<mark style="background-color:purple;">This is a conditional field.</mark>

A unique reference number for the generated wallet | Ex: `1000058915`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="receiverAccountType" type="string(100) " required="false" %}
Receiver account type is the account type of receiver | Ex.

`Wallet/Account/Merchant`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="receiver" type="string(100)" required="true" %}
Name of destination from where fund is going from prepaid system | Ex:

`Bank name (HDFC)Amazon`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="receiverAccount" type="String(30)" required="false" %}
Receiver account is the account to which funding is happening | Ex.

`00112233445566`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="sourceType " type="numeric(2) " required="false" %}
Source account type is the account type from which funding of prepaid account will happen. | Ex.

`Wallet/Account`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="sourceName" required="true" type="string(100) " %}
Name of source from where fund is coming to prepaid system. In case of refund transaction, Merchant name is mentioned | Ex:

`Bank name (HDFC)Amazon`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="sourceAccount " type=" string(30)  " required="false" %}
Source account is the account from which funding is happening | Ex.

`00112233445566`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="transactionAmount" type="Numeric(12)" required="true" %}
Amount for which card needs to be activated. It is in implied decimals | Ex:

`100`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="fee" type="numeric(10)" required="false" %}
Fee collected for the transaction.

<mark style="background-color:orange;">Not applicable for this API.</mark>
{% endswagger-parameter %}

{% swagger-parameter in="body" name="originalClientTxnId" type="string(500)" required="false" %}
<mark style="background-color:purple;">This is a conditional field.</mark>

Unique Id generated by the client for each transaction | Ex: `20150701235959xhstiesqfds`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="refundFileId" type="string(500)" required="false" %}
Used to store the file related information for this request | Ex:

`201607040918424092qE93qKGGE3456.csv`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="fundFlowType" type="String(20)" required="true" %}
Used to store fund Flow type for Load/Unload requests | Ex:

`O, I, IO, OR, IR, IOR`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="implId" type="String(100)" required="true" %}
IMPL ID for each event | Ex:

`IR|70|700000000`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="ImplType" type="String" required="true" %}
IMPL ID Type | Ex: `P2M_W2A_OUTFLOW` `P2M_W2A_OUTFLOW` or/

`P2P_W2A_OUTFLOW_REFUND,` `P2P_W2A_INFLOW_REFUND`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="pgNo" type="String" required="false" %}
To capture Payment Gateway No. | Ex:

`Pg-122`
{% endswagger-parameter %}

{% swagger-parameter in="body" type="String" name="orderId" required="false" %}
To capture order ID from Payment gateway | Ex:

`O12314`
{% endswagger-parameter %}

{% swagger-parameter in="body" name="beneficiaryId " type="String  " required="false" %}
To capture Beneficiary ID. Basis valid beneficiary ID in this field, the P2P limit will be defined for that transaction | Ex:

`B12312`
{% endswagger-parameter %}

{% swagger-response status="200: OK" description="" %}
```javascript
{
    //Response
}
```
{% endswagger-response %}
{% endswagger %}

#### Response Body

| **messageCode**         | numeric(4)  | Y         | Code to Identity Load Unload Account API response type                      | Refer to the message code reference.                                                                                                                 | 1991                      |
| ----------------------- | ----------- | --------- | --------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------- |
| **clientTxnId**         | string(100) | Y         | Unique Id generated by the client for each transaction.                     | Value copied from the request                                                                                                                        | 20150701235959xhstiesqfds |
| **responseDateTime**    | numeric(14) | Y         | Response date and timestamp when the transaction originated from the client | Format is YYYYMMDDHHMMSS with time in 24-hour format                                                                                                 | 20161031214559            |
| **customerId**          | string(20)  | Y         | Unique customer identifier that is generated by the client                  | This is fetched from Wibmo Prepaid basis customer’s mobile. no                                                                                       | 9712938648                |
| **accosaTransactionId** | numeric(10) | Y         | Unique id for a particular transaction generated in Prepaid system          | Unique Identifier for a transaction                                                                                                                  | 3591893                   |
| **responseCode**        | string(4)   | Y         | Response code of the action executed.                                       | Contains the status of the transaction. 00 indicates success.                                                                                        | 00                        |
| **responseMessage**     | string(100) | N         | Description of the response code.                                           | Response message based on response code will be sent                                                                                                 | Unload successful         |
| **urn**                 | numeric(10) | Mandatory | A unique reference number for the generated card.                           | Unique identifier for card/wallet                                                                                                                    | 1000058915                |
| **transactionAmount**   | numeric(12) | Mandatory | Load/Unload Amount passed with implied decimals.                            | It is in implied decimals by two digits. Ex. if amount is INR 5.50, then implied decimal is 550. If the amount is INR 3, then implied decimal is 300 | 210000                    |
| **availableBalance**    | numeric(12) | Mandatory | Available Balance in the wallet after successful reload/unload.             | It is in implied decimals by two digits. Ex. if amount is INR 5.50, then implied decimal is 550. If the amount is INR 3, then implied decimal is 300 | 210000                    |
| **accosaRefNo**         | numeric(20) | Mandatory | Auto generated sequence number in CMS events                                |                                                                                                                                                      | 123212                    |

{% tabs %}
{% tab title="Curl" %}
```json
Sample Load Unload Account API Request
https://pp-sandbox.wibmo.com/api/v2/customer/loadunloadaccount
Sample Request
Encrypted req->
{
"token":"Pl8F5kDZcvADIiursiAvvbHNuL9Wv5eaFdorGVFU6FKfIEnV/YskkzJlAov2ZHJWnqGNLOXfBq4SQqw8Ep4sK0gCAAkRXATCb1nSY6s=" 
}
// Sample token. Client will have to generate this token. 
Decrypted req->
{
    "messageCode": "1990",
    "clientTxnId": "Load_V3_gkeqKaRjhqhaUpW",
    "requestDateTime": "20220302153027",
    "urn": 389,
    "customerId": "",
    "mobile": "",
    "transactionAmount": 20100,
    "fee":100,
    "sender": "AMAZON",
    "receiver": "CITRUS",
    "receiverAccountType": "wallet",
    "receiverAccount": "SOURAV",
    "loadCurrency": "INR",
    "unloadCurrency": "INR",
    "sourceaccountType": "Account",
    "sourceAccount": "27389282",
    "originalClientTxnId": "",
    "implId": "IO|70030",
    "implType": "P2M_A2W_I,P2M_W2A_O",
    "refundFileId": "201607040918424092qE93qKGGE3456.csv",
    "fundFlowType": "IO"
}
```
{% endtab %}

{% tab title="Response (Success)" %}
<pre class="language-json"><code class="lang-json">Encrypted Response->
<strong>{
</strong>"token":"Pl8F5kDZcvADIiursiAvvbHNuL9Wv5eaFdorGVFU6FKfIEnV/YskkzJlAov2ZHJWnqGNLOXfBq4SQqw8Ep4sK0gCAAkRXATCb1nSY6s=" 
}
//Sample token. Client will have to decrypt the token shared in the response body
Decrypted Response->
{
    "clientId": "WibmoClient",
    "responseDateTime": "20221116114243",
    "accosaTransactionId": 7442,
    "responseCode": "00",
    "availableBalance": 100000,
    "urn": 389,
    "bankId": 2010,
    "accosaRefNo": "763",
    "clientTxnId": "Load_V3_gkeqKaRjhqhaUpW",
    "transactionAmount": 20100,
    "customerId": "custid_V3_juyWqcUUxz",
    "messageCode": 1991,
    "responseMessage": "SUCCESS",
    "availableCashLimit": 0
}
</code></pre>
{% endtab %}

{% tab title="Response (Failure)" %}
<pre class="language-json"><code class="lang-json">Encrypted Response->
<strong>{
</strong>"token":"Pl8F5kDZcvADIiursiAvvbHNuL9Wv5eaFdorGVFU6FKfIEnV/YskkzJlAov2ZHJWnqGNLOXfBq4SQqw8Ep4sK0gCAAkRXATCb1nSY6s=" 
}
//Sample token. Client will have to decrypt the token shared in the response body
Decrypted Response->
{
    "urn": 390,
    "bankId": 2010,
    "clientId": "WibmoClient",
    "responseDateTime": "20221116121252",
    "clientTxnId": "Load_V3_uJrZu=RdVxc3=WW",
    "accosaTransactionId": 7448,
    "customerId": "custid_npNFji6bc",
    "messageCode": 1991,
    "responseMessage": "RELOAD DAILY LIMIT",
    "responseCode": "1021"
}
</code></pre>
{% endtab %}
{% endtabs %}

| **1058** | INVALID\_WALLETS                                     |
| -------- | ---------------------------------------------------- |
| **1247** | SOURCE\_ACC\_TYPE\_NOT\_MACHED\_WITH\_IMPL           |
| **1135** | REFUND\_AMOUNT\_GREATER\_THAN\_ORIGINAL\_TXN\_AMOUNT |
| **1246** | ORIGINAL\_TXN\_NOT\_EXIST                            |
| **1247** | SOURCE\_ACC\_TYPE\_NOT\_MACHED\_WITH\_IMPL           |
| **1045** | UNABLE\_TO\_PROCESS\_REQUEST                         |
| **1504** | SYSTEM\_CAS\_FAILURE                                 |
| **1501** | SYSTEM\_ERROR\_DB                                    |
| **1009** | CARD\_CANCELLED\_CLOSED\_EXPIRED                     |
| **1010** | CARD\_TEMPORARY\_BLOCK                               |
| **1012** | CARD\_PENDING\_CANCELLATION                          |
| **1121** | CARD\_CREDIT\_DEBIT\_BLOCK                           |
| **1045** | UNABLE\_TO\_PROCESS\_REQUEST                         |
| **1101** | UNKNOWN\_SOURCE\_ACCOUNT\_TYPE                       |
| **1013** | AML\_MIN\_LIMIT                                      |
| **1102** | UNKNOWN\_DESTINATION\_ACCOUNT\_TYPE                  |
| **1030** | INVALID\_MESSAGE                                     |
| **1128** | INVALID\_TRACE\_NUMBER                               |
